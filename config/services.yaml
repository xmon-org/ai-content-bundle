services:
    _defaults:
        autowire: true
        autoconfigure: true

    # Form Types
    Xmon\AiContentBundle\Form\AiStyleConfigType:
        arguments:
            $imageOptionsService: '@Xmon\AiContentBundle\Service\ImageOptionsService'
        tags: ['form.type']

    # Image Providers
    Xmon\AiContentBundle\Provider\Image\PollinationsImageProvider:
        arguments:
            $apiKey: null
            $model: 'flux'
            $timeout: 120
            $defaultWidth: 1280
            $defaultHeight: 720
        tags:
            - { name: 'xmon_ai_content.image_provider', priority: 1 }
            - { name: 'monolog.logger', channel: 'ai' }

    # Main Image Service
    Xmon\AiContentBundle\Service\AiImageService:
        arguments:
            $providers: !tagged_iterator { tag: 'xmon_ai_content.image_provider', default_priority_method: 'getPriority' }
            $retries: 3
            $retryDelay: 5
        tags:
            - { name: 'monolog.logger', channel: 'ai' }

    # Image Options Service (styles, compositions, palettes, extras, presets)
    Xmon\AiContentBundle\Service\ImageOptionsService:
        arguments:
            $styles: []
            $compositions: []
            $palettes: []
            $extras: []
            $presets: []

    # Variant Selector (selects variants based on content)
    Xmon\AiContentBundle\Service\VariantSelector:
        tags:
            - { name: 'monolog.logger', channel: 'ai' }

    # Prompt Template Service (configurable system/user prompts)
    Xmon\AiContentBundle\Service\PromptTemplateService:
        arguments:
            $templates: []
            $variantSelector: '@Xmon\AiContentBundle\Service\VariantSelector'
        tags:
            - { name: 'monolog.logger', channel: 'ai' }

    # Prompt Builder (combines subject with style options)
    Xmon\AiContentBundle\Service\PromptBuilder: ~

    # Style Providers
    Xmon\AiContentBundle\Provider\Style\YamlStyleProvider:
        tags:
            - { name: 'xmon_ai_content.style_provider', priority: 0 }

    # Style Service (aggregates style providers)
    Xmon\AiContentBundle\Service\AiStyleService:
        arguments:
            $providers: !tagged_iterator { tag: 'xmon_ai_content.style_provider', default_priority_method: 'getPriority' }

    # Console Commands
    Xmon\AiContentBundle\Command\DebugConfigCommand:
        tags: ['console.command']
